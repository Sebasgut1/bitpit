---
layout: doxygen_header
title: Manual - PABLO_example_00001.cpp
section: documentation
doxygen-show-titlearea: 0
extra-head-includes:
    - doxygen_extra_head.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
{% if page.doxygen-show-titlearea == 1 %}
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">bitpit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
{% endif %}
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PABLO_example_00001.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>2D adaptive mesh refinement (AMR) using PABLOThis example creates a 2D Octree mesh on the square domain [0,1]x[0,1].</p>
<p>The domain is refined globally one time, then refined iteratively using two different refinement criteria. At the end of the iterative refinement, one global refinement is performed again.</p>
<p>In the first criterion, each octant generated by a previous refinement iteration is marked for further refinement if its center is within a circle with a specified radius. Iterative refinement stops when a fixed number of iteration is reached.</p>
<p>In the second criterion, the refinement is performed using the same rules of the first criterion. However, this refinement is performed until the flag returned by the adapt method is true (for further details about adapt method, please visit documentation). Video below illustrates the iterative refinement. Each frame show the result of a refinement iteration starting from the ancestor quadrant up to the last global refinement.</p>
<p>The upper part of the domain is adapted by a refinement procedure using the first criterion, while the bottom part by a refinement procedure using the second criterion.</p>
<p>Moreover, in the right hand side of the domain, the 2:1 balancing is deactivated.</p>
<p><b>To run</b>: ./PABLO_example_00001 <br  />
 <b>To see the result visit</b>: <a href="http://optimad.github.io/PABLO/">PABLO website</a> <br  />
 </p><div class="fragment"><div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  bitpit</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  Copyright (C) 2015-2021 OPTIMAD engineering Srl</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  -------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *  License</span></div>
<div class="line"><span class="comment"> *  This file is part of bitpit.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  bitpit is free software: you can redistribute it and/or modify it</span></div>
<div class="line"><span class="comment"> *  under the terms of the GNU Lesser General Public License v3 (LGPL)</span></div>
<div class="line"><span class="comment"> *  as published by the Free Software Foundation.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  bitpit is distributed in the hope that it will be useful, but WITHOUT</span></div>
<div class="line"><span class="comment"> *  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div>
<div class="line"><span class="comment"> *  FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public</span></div>
<div class="line"><span class="comment"> *  License for more details.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span></div>
<div class="line"><span class="comment"> *  along with bitpit. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;bitpit_PABLO.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">using namespace </span>bitpit;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// =================================================================================== //</span></div>
<div class="line"><span class="comment"></span><span class="comment">// =================================================================================== //</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> run()</div>
<div class="line">{</div>
<div class="line">    PabloUniform pablo1(2);</div>
<div class="line"> </div>
<div class="line">    pablo1.computeConnectivity();</div>
<div class="line">    pablo1.write(<span class="stringliteral">&quot;pablo00001_iter0&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    pablo1.adaptGlobalRefine();</div>
<div class="line">    pablo1.updateConnectivity();</div>
<div class="line">    pablo1.write(<span class="stringliteral">&quot;pablo00001_iter1&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> xc, yc;</div>
<div class="line">    xc = yc = 0.5;</div>
<div class="line"> </div>
<div class="line">    pablo1.setBalanceCodimension(1);</div>
<div class="line"> </div>
<div class="line">    uint32_t nocts = pablo1.getNumOctants();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nocts; i++){</div>
<div class="line">        array&lt;double,3&gt; center = pablo1.getCenter(i);</div>
<div class="line">        <span class="keywordtype">double</span> x = center[0];</div>
<div class="line">        <span class="keywordflow">if</span> (x&gt;xc)</div>
<div class="line">            pablo1.setBalance(i,<span class="keyword">false</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> radius = 0.4;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> nref1 = 6;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter=0; iter&lt;nref1; iter++){</div>
<div class="line">        nocts = pablo1.getNumOctants();</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nocts; i++){</div>
<div class="line">            Octant *oct = pablo1.getOctant(i);</div>
<div class="line">            array&lt;double,3&gt; center = pablo1.getCenter(oct);</div>
<div class="line">            <span class="keywordtype">double</span> x = center[0];</div>
<div class="line">            <span class="keywordtype">double</span> y = center[1];</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> ((<a name="a0"></a><a class="code" href="group__MathFunctions.html#ga6da0697577be6fda9b574b2344c58014">pow</a>((x-xc),2.0)+<a class="code" href="group__MathFunctions.html#ga6da0697577be6fda9b574b2344c58014">pow</a>((y-yc),2.0) &lt; <a class="code" href="group__MathFunctions.html#ga6da0697577be6fda9b574b2344c58014">pow</a>(radius,2.0)) &amp;&amp;</div>
<div class="line">                    (y&lt;yc)){</div>
<div class="line">                pablo1.setMarker(oct, 1);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        pablo1.adapt();</div>
<div class="line">        pablo1.updateConnectivity();</div>
<div class="line">        pablo1.write(<span class="stringliteral">&quot;pablo00001_iter&quot;</span>+to_string(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(iter+2)));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> nref2 = 5;</div>
<div class="line">    <span class="keywordtype">int</span> iter = 0;</div>
<div class="line">    <span class="keywordtype">bool</span> done = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">while</span>(iter&lt;=nref2){</div>
<div class="line">        done = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">while</span>(done)</div>
<div class="line">        {</div>
<div class="line">            nocts = pablo1.getNumOctants();</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nocts; i++){</div>
<div class="line">                array&lt;double,3&gt; center = pablo1.getCenter(i);</div>
<div class="line">                <span class="keywordtype">double</span> x = center[0];</div>
<div class="line">                <span class="keywordtype">double</span> y = center[1];</div>
<div class="line">                <span class="keywordflow">if</span> ((<a class="code" href="group__MathFunctions.html#ga6da0697577be6fda9b574b2344c58014">pow</a>((x-xc),2.0)+<a class="code" href="group__MathFunctions.html#ga6da0697577be6fda9b574b2344c58014">pow</a>((y-yc),2.0) &lt; <a class="code" href="group__MathFunctions.html#ga6da0697577be6fda9b574b2344c58014">pow</a>(radius,2.0)) &amp;&amp;</div>
<div class="line">                        (y&gt;yc) &amp;&amp; iter&lt;=nref2 &amp;&amp; pablo1.getLevel(i)&lt;=iter+1){</div>
<div class="line"> </div>
<div class="line">                    pablo1.setMarker(i, 1);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            done = pablo1.adapt();</div>
<div class="line">            pablo1.updateConnectivity();</div>
<div class="line">            pablo1.write(<span class="stringliteral">&quot;pablo00001_iter&quot;</span>+to_string(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(iter+nref1+2)));</div>
<div class="line">        }</div>
<div class="line">        iter++;</div>
<div class="line">    }</div>
<div class="line">    pablo1.adaptGlobalRefine();</div>
<div class="line">    pablo1.updateConnectivity();</div>
<div class="line">    pablo1.write(<span class="stringliteral">&quot;pablo00001_iter&quot;</span>+to_string(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(iter+nref1+3)));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    MPI_Init(&amp;argc,&amp;argv);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <a name="a1"></a><a class="code" href="group__common__macro.html#gacb5eef7cdb2adda3b65bfe01c66667a4">BITPIT_UNUSED</a>(argc);</div>
<div class="line">    <a class="code" href="group__common__macro.html#gacb5eef7cdb2adda3b65bfe01c66667a4">BITPIT_UNUSED</a>(argv);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> nProcs;</div>
<div class="line">    <span class="keywordtype">int</span> rank;</div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;nProcs);</div>
<div class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    nProcs = 1;</div>
<div class="line">    rank   = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize the logger</span></div>
<div class="line">    log::manager().initialize(log::SEPARATE, <span class="keyword">false</span>, nProcs, rank);</div>
<div class="line">    log::cout() &lt;&lt; <a class="code" href="namespacebitpit_1_1log.html#acd50005e81bd303fa96065d563592348">fileVerbosity</a>(log::NORMAL);</div>
<div class="line">    log::cout() &lt;&lt; <a class="code" href="namespacebitpit_1_1log.html#ad6f89bcb2adf0f51cb232969b714e83b">consoleVerbosity</a>(log::QUIET);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run the example</span></div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        run();</div>
<div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;exception) {</div>
<div class="line">        log::cout() &lt;&lt; exception.what();</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    MPI_Finalize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__MathFunctions_html_ga6da0697577be6fda9b574b2344c58014"><div class="ttname"><a href="group__MathFunctions.html#ga6da0697577be6fda9b574b2344c58014">pow</a></div><div class="ttdeci">std::array&lt; T, d &gt; pow(std::array&lt; T, d &gt; &amp;x, double p)</div><div class="ttdef"><b>Definition:</b> <a href="MathOperators__array_8tpp_source.html#l00637">MathOperators_array.tpp:637</a></div></div>
<div class="ttc" id="agroup__common__macro_html_gacb5eef7cdb2adda3b65bfe01c66667a4"><div class="ttname"><a href="group__common__macro.html#gacb5eef7cdb2adda3b65bfe01c66667a4">BITPIT_UNUSED</a></div><div class="ttdeci">#define BITPIT_UNUSED(variable)</div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00063">compiler.hpp:63</a></div></div>
<div class="ttc" id="anamespacebitpit_1_1log_html_acd50005e81bd303fa96065d563592348"><div class="ttname"><a href="namespacebitpit_1_1log.html#acd50005e81bd303fa96065d563592348">bitpit::log::fileVerbosity</a></div><div class="ttdeci">LoggerManipulator&lt; log::Verbosity &gt; fileVerbosity(const log::Verbosity &amp;verbosity)</div><div class="ttdef"><b>Definition:</b> <a href="logger_8cpp_source.html#l01546">logger.cpp:1546</a></div></div>
<div class="ttc" id="anamespacebitpit_1_1log_html_ad6f89bcb2adf0f51cb232969b714e83b"><div class="ttname"><a href="namespacebitpit_1_1log.html#ad6f89bcb2adf0f51cb232969b714e83b">bitpit::log::consoleVerbosity</a></div><div class="ttdeci">LoggerManipulator&lt; log::Verbosity &gt; consoleVerbosity(const log::Verbosity &amp;verbosity)</div><div class="ttdef"><b>Definition:</b> <a href="logger_8cpp_source.html#l01517">logger.cpp:1517</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
---
layout: doxygen_footer
---
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<address class="footer"><small>
Generated on Mon Mar 29 2021 21:17:46 for bitpit by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.1
</small></address>
